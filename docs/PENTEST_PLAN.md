# Agent Pulse Pentest Plan (Doc Only)

## Objective
Validate the security posture of Agent Pulse (web UI + API + onchain eligibility logic) and
identify high-impact issues before launch. This plan is documentation-only and does not
require production secrets or mainnet keys.

## Scope (In)
- `apps/web` UI and API routes.
- Eligibility logic (ALIVE checks, ERC-8004 optional gate).
- Inbox key issuance and task retrieval (`/api/inbox/*`).
- Event indexing logic (Transfer to signal sink).
- Configuration and env handling (`.env.example` + runtime vars).
- Rate limiting and abuse controls.
- Logging, error handling, and data exposure.

## Out of Scope (Explicit)
- Onchain contract security audits (token/registries) beyond integration behavior.
- Treasury and operational multisig processes.
- Frontend marketing/branding content.
- Any unrelated repos.

## Environments
- Local dev (`apps/web`).
- Base fork (Anvil/Tenderly) for event feed validation.
- Staging deploy (Vercel preview with non-production envs).

## Success Criteria
- No unauthenticated path can mint or fetch inbox keys.
- ALIVE check cannot be bypassed client-side.
- Rate limits prevent key spamming and inbox enumeration.
- No secrets are exposed to the client bundle or logs.
- Routing eligibility matches onchain state within TTL.

## Threat Model (High-Level)
- **Key abuse:** attacker attempts to mint/steal inbox keys.
- **Eligibility bypass:** spoofing ALIVE or ERC-8004 status.
- **Rate limit evasion:** IP rotation or replay to drain key issuance.
- **Event feed spoofing:** incorrect chain, RPC hijack, or reorg edge cases.
- **Data exposure:** leaking wallets, keys, or internal errors.

## Test Matrix

### API / Inbox Gate
- Verify server-side ALIVE checks are enforced even if client bypasses UI.
- Attempt key issuance without pulse and/or without ERC-8004 (when enabled).
- Verify key TTL enforcement and expiration.
- Attempt key replay after TTL or from a different wallet.
- Confirm rate limits on key issuance and inbox reads.

### Eligibility / Indexing
- Reorg handling: confirm ALIVE logic tolerates small reorgs with confirmations.
- Check log scan chunking and retries.
- Verify chain ID enforcement (Base only) for RPC responses.
- Confirm no reliance on client timestamps for eligibility.

### Web UI
- Confirm no secret env vars shipped to client bundle.
- Test for XSS via wallet labels or log fields.
- Validate CORS and CSP (if configured).

### Abuse & Availability
- Fuzz API routes (invalid wallet strings, large payloads).
- Check for SSRF via RPC URL override or query inputs.
- Validate logging does not include private keys or headers.

### Dependency & Supply Chain
- `npm audit` and lockfile review for high-severity issues.
- Scan for insecure runtime dependencies (e.g., deprecated crypto libs).

## Swarm Agent Roles
1. **API/Key Issuance Agent:** focus on inbox key issuance, TTL, rate limits.
2. **Eligibility/Indexing Agent:** focus on ALIVE checks, chain ID, log indexing.
3. **Web UI Agent:** focus on client bundle exposure, XSS, misconfig.
4. **Infra Agent:** focus on Vercel config, headers, env leakage.

## Deliverables
- Findings table with severity, evidence, reproduction steps, and fix guidance.
- Minimal patch list (if low-risk quick fixes are found).
- Retest notes confirming remediation.

## Guardrails
- No production private keys.
- No mainnet transactions.
- Do not commit secrets.
- Do not use DEX links or trading language in reports.
