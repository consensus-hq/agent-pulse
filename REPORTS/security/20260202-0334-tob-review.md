# Trail of Bits Security Review — golem-compute-skill

**Date:** 2026-02-02 03:34 (America/New_York)  
**Reviewer:** Connie Security (OpenClaw)  
**Repo:** `/opt/fundbot/work/workspace-connie/golem-compute-skill`

## Scope
- **In scope:** `src/`, `scripts/`, `docs/`, `tools.json`, `SKILL.md`, `package.json`.
- **Out of scope:** `node_modules/`, `dist/` (generated).  
- **Network/CVE lookups:** **None performed.**

## Methodology (Trail of Bits plugins)
- audit-context-building
- entry-point-analyzer
- insecure-defaults
- sharp-edges
- static-analysis (manual review only; no networked tooling)
- differential-review (no baseline diff provided)

## Executive Summary
No **critical** or **high** severity issues were found. The main risks are logic/authorization gaps in token gating and missing chain-id validation for swap execution. There is also a low-to-medium risk of shell injection into rented compute commands, and a few operational/security hardening items in scripts.

## Findings Summary
| ID | Severity | Title | Files |
|---|---|---|---|
| F-01 | **Medium** | Token-gating bypass due to default tier assignment | `src/fee-manager.ts` |
| F-02 | **Medium** | Missing chainId validation for swap execution | `src/project-token-swap.ts`, `docs/BASE_ECOSYSTEM_INTEGRATIONS.md` |
| F-03 | **Low** | Command injection in remote VM run path via taskDescription | `src/skill.ts` |
| F-04 | **Low** | Unlimited ERC20 approvals to router | `src/project-token-swap.ts` |
| F-05 | **Low** | Automation scripts accept credentials via env without enforced secret manager | `scripts/github-login.mjs`, `scripts/privateemail-login.mjs` |

---

## Detailed Findings

### F-01 — Token-gating bypass due to default tier assignment
**Severity:** Medium  
**Location:** `src/fee-manager.ts` (`ProjectTokenGate.checkUserTier`)

**Issue:** `checkUserTier` returns `tier: "basic"` with `balance: 0` for all users, and the `access` tier (minBalance=1) is never enforced. This bypasses the intended anti‑Sybil/concurrency gate, allowing zero‑balance addresses to access the “basic” tier features and limits.

**Impact:** Users without the minimum project token balance can bypass access controls and gain more concurrent jobs/features than intended. This undermines token-gated policy and can lead to unmetered usage.

**Recommendation:**
- Add an explicit `access` tier to `UserTokenInfo.tier` and enforce it in `checkUserTier`.
- Use `PROJECT_TOKEN_TIER_CONFIG.access` as the default when balance < `minBalance`.
- Gate higher concurrency/features based on actual balance or on‑chain check.

---

### F-02 — Missing chainId validation for swap execution
**Severity:** Medium  
**Location:** `src/connie-swap.ts`, `docs/BASE_ECOSYSTEM_INTEGRATIONS.md`

**Issue:** Swap execution does not verify `chainId` or contract code before transacting. A misconfigured or malicious RPC endpoint could cause swaps to execute on an unintended chain (or fork), risking funds and approvals to unexpected contracts. The doc already notes this as a TODO.

**Impact:** Potential loss of funds if swaps execute on the wrong chain or against a malicious router/token address set.

**Recommendation:**
- Assert `chainId === 8453` (Base) before any swap/approval.
- Optionally verify code hashes/bytecode at router/token addresses.
- Refuse to swap if the chainId check fails.

---

### F-03 — Command injection in remote VM run path via taskDescription
**Severity:** Low  
**Location:** `src/skill.ts` (`buyCompute`)

**Issue:** `taskDescription` is interpolated into a shell command: 
```ts
exe.run(`echo "${taskDescription.replace(/\"/g, "\\\"")}" && uname -a`)
```
Only double quotes are escaped, leaving shell expansion (`$(...)`, backticks) and other characters intact. If `taskDescription` is user‑controlled, it can execute unintended commands inside the rented VM.

**Impact:** Remote command execution on the rented provider VM, which could lead to unintended compute usage or costs. While it doesn’t directly affect the local host, it violates the expectation that `taskDescription` is “data only.”

**Recommendation:**
- Avoid shell interpolation; use a safe API if `golem-js` supports passing argv without a shell.
- If a shell is required, wrap the content using single‑quote escaping or base64 encode and decode in the VM.
- Treat `taskDescription` as untrusted input.

---

### F-04 — Unlimited ERC20 approvals to router
**Severity:** Low  
**Location:** `src/connie-swap.ts` (`executeSwapExactIn`)

**Issue:** The swap path approves `MaxUint256` when allowance is insufficient. If the router address is compromised or incorrect, this grants unlimited token access.

**Impact:** Potential token drain if a malicious or wrong router is used.

**Recommendation:** Approve only the exact `amountIn`, or immediately revoke approval after the swap. Combine with chainId and code-hash checks (see F‑02).

---

### F-05 — Automation scripts accept credentials via env without enforced secret manager
**Severity:** Low  
**Location:** `scripts/github-login.mjs`, `scripts/privateemail-login.mjs`

**Issue:** These scripts read passwords from environment variables. While some scripts mention `op run`, it’s not enforced or consistent. Environment variables can leak via process inspection or logs.

**Impact:** Potential credential exposure if scripts are run in shared environments or with verbose logging.

**Recommendation:**
- Require secrets injection via 1Password (`op run`) or another secret manager.
- Document and enforce non‑logging of secrets.
- Consider reading secrets from stdin or OS keychain instead of env vars.

---

## Additional Observations / Hardening
- `.gitignore` excludes `**/secrets/**` and `.env*` — good.
- `scripts/preflight.sh` sets `chmod 600` on the app‑key file — good.
- Consider adding unit tests for tier enforcement and swap chainId checks.

## Static Analysis Recommendations (not executed)
- `npm audit --production` (networked; run in CI)
- Semgrep JS/TS rules for command injection and secrets exposure
- ESLint security plugin (`eslint-plugin-security`)

---

## Differential Review
No baseline diff or previous report was provided, so a differential review was not performed.
